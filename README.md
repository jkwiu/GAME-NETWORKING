# GAME-NETWORKING

[원본 강의 동영상](https://www.youtube.com/watch?v=lAhAdnsIN6I&list=PLy-g2fnSzUTDsS7kCzmFYn4BJK6nCs0_r&ab_channel=Tucker%EC%9D%98GoLang%ED%94%84%EB%A1%9C%EA%B7%B8%EB%9E%98%EB%B0%8D)

1. 네트워킹이란?
   1. 데이터를 주고 받는 것, 컴퓨터안의 cpu, ram 간 데이터를 주고 받는 것도 네트워킹이다.
   2. 컴퓨터 내부와 외부 네트워킹의 차이점
      1. 지연시간(latency)
         1. 지구 한바퀴를 빛이 도는 시간(133ms = 0.13sec)
            1. 굉장히 빠른 것같지만, 컴퓨터 입장에서는 굉장히 느리다.
         2. **게임에서 얼마나 ``Latency``를 눈속임하느냐가 관건이다.**
            1. 아무리 빨라도 물리적인 한계 때문에 속도를 줄이는 것은 안된다.
      2. 연결의 불안정성
         1. 인터넷은 여러 거점을 거쳐가는데 이 경로 중 하나가 문제가 생기면 연결이 끊어진다.
            1. 연결이 취약하므로 언제든지 끊김이 발생할 수 있다.
            2. 근래는 모바일 무선네트워크를 많이 쓰므로 더 빈도가 높다.
            3. **이러한 끊김에 대한 안정성을 커버하는 것이 관건이다.** 
      3. 순서 비보장
         1. 내부
            1. 순서대로
         2. 외부
            1. 랜덤
            2. 모든 path를 살포하여 가장 빠른 쪽을 캐쉬에 기억했다가 전송한다.
         3.  **패킷 순서를 보장하는 것이 관건이다.**
2.  Protocol TCP/UDP
    1.  TCP
        1.  Hardware에서 다음 3가지를 보장해주자.
            1.  연결은 추상적 개념
            2.  연결 유무확인
                1.  ``3 way handshake``
                    1.  req
                    2.  res
                    3.  res에 대한 res
                2.  Connect / Disconnect 를 알 수 있게 프로그래밍
            3.  순서보장
            4.  송신보장
        2.  단점
            1. 지연시간이 느리다(3번 주고 받아야 해서 느림)
        3. 느려도 되는 게임
           1. MMORPG, 보드게임
    2.  UDP
        1. 연결 유무x
        2. 순서 보장x 
        3. 송신 보장x
        4. 장점
           1. 지연시간이 빠르다(1번 줘서 빠름)
        5. 단점
           1. 데이터가 유실될 수 있다.
        6. 빠른 반응 속도 필요
           1. 격투게임, 슈팅게임, LOL, 오버워치, 스타크래프트
    3. Reliable UDP
       1. 빠른 UDP를 쓰기 위해 프로그래밍된 **software**
       2. UDP에서의 순서보장, 송신 보장을 해주기 위해 만든 **software**
       3. 만들기 쉽지 않다.
          1. 과거에는 블리자드 같은 대형회사에서 자체적으로 만들었으나 요즘에는Unity, Unreal에서 제공해주고 Open Source도 많아졌다.
3. Deterministic 방식
   1. 같은 ``input``이면 같은 ``result``가 나온다는 가정하에 시작
      1. delay
      2. rollback
      3. relay server
   2. 데이터를 다루는 방식(TCP/UDP는 전송 방식)
   3. 같은 입력을 같은 시간에 어떻게 넣느냐가 관건
   4. Deterministic
      1. UDP
      2. a와 b의 input에 대한 output을 지연시킴으로써 a와 b의 output시간을 맞춰주는 개념
      3. ``desync``상황을 잡기 힘들다.
         1. 언제 어디서 발생할지도 예측불가
   5. Server Authority
      1. TCP
4. Delay와 Rollback
   1. ``latency``만큼 ``delay``를 줘서 sync를 맞춰주는 방법(보통 ``100ms`` 줌)
   2. 단점
      1. delay가 생김(랙)
   3. 도달시간이 150ms라치면 100ms의 delay를 줘도 문제가 생긴다. 이럴 때 ``Rollback``
   4. Rollback
      1. 지연된 시간만큼 Rollback하여 다시 앞감기를 하여 sync를 맞춘다.
      2. 단점
         1. 프레임이 튄다.(플레이어가 갑자기 순간이동)
         2. 구현이 매우 어렵다.
            1. 뒤감기 -> 앞감기
               1. 10명일 때 모든 data를 기억하고 있다가 다시 넣어줘야함
            2. 입력을 중간에 집어넣기
            3. 구현이 어렵기 때문에 ``input``이 오는 것과 상관없이 매 프레임 롤백하는 방식을 사용함.
      3. ``fps``에서 많이 씀.
   5. 그렇기 때문에 Delay와 Rollback을 섞어 쓴다.
      1. Ex)
         1. 오버워치가 잘 Delay & Rollback이 잘 구현되어 있다.
            1. 트레이서의 ``되돌리기`` 스킬
         2. LoL Replay
            1. 시작부터 끝까지 ``state``의 값이 아닌 ``input``의 값을 모두 기록해야 한다.
5. 다른 유용한 방식들
   1. 중계서버(Relay Server / Broadcast Server)
      1. 모든 클라이언트는 똑같은 ``input``을 받는다.
      2. 타임슬롯에 해당 ``input``들을 넣는다.(``turn제`와 같다)
         1. 각 ``player``는 서버에 자신의 행동을 보낸다.
         2. ``server``가 취합한다.
      3. 장점
         1. 구현이 쉽고 ``desync``도 잘 일어나지 않는다.
      4. 단점
         1. 반응성이 떨어진다. 
      5. ``AOS``, ``스포츠``에서 많이 씀